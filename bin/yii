#!/usr/bin/env php
<?php

declare(strict_types=1);

require './vendor/autoload.php';
require __DIR__ . '/Di.php';

use Psr\SimpleCache\CacheInterface;
use Symfony\Component\Console\Application;
use Yiisoft\Db\Connection\ConnectionInterface;
use Yiisoft\Di\Container;
use Yiisoft\Di\ContainerConfig;

$application = new Application('migration', '1.0.0');

$containerConfig = ContainerConfig::create()->withDefinitions(Di::definitions());
$container = new Container($containerConfig);

if ($container->has(CacheInterface::class) === false) {
    throw new \RuntimeException('CacheInterface not found in container');
}

if ($container->has(ConnectionInterface::class) === false) {
    throw new \RuntimeException('ConnectionInterface not found in container');
}

foreach (Di::getCommands() as $command) {
    $application->add($container->get($command));
}

$application->run();
